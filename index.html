<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Coffee Quest AR - SAE 402</title>
  
  <!-- ============================================
       LIBRAIRIES EXTERNES
       ============================================ -->
  
  <!-- A-Frame : Le moteur 3D/XR -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
</head>

<body>
  <!-- ============================================
       INTERFACE HTML (visible avant l'AR)
       ============================================ -->
  
  <!-- Panel de debug en haut a gauche -->
  <div id="debug-panel">
    <h2>Coffee Quest AR</h2>
    <p>Placez des tasses de cafe dans votre espace !</p>
    <p id="cup-count">Tasses posees: 0</p>
    <p id="debug-status">Chargement...</p>
  </div>
  
  <!-- Bouton pour lancer l'AR -->
  <button id="start-ar-btn">Demarrer en AR</button>
  
  <!-- Instructions -->
  <div id="instructions">
    <strong>Manette droite :</strong><br>
    A = Creer une tasse<br>
    Trigger = Poser la tasse<br>
    Grip = Attraper une tasse
  </div>

  <!-- ============================================
       SCENE A-FRAME
       ============================================
       
       C'est ici que tout le 3D se passe !
       
       ATTRIBUTS DE LA SCENE :
       - webxr : Configure les features WebXR (hit-test, etc.)
       - vr-mode-ui : Desactive le bouton VR par defaut
       - renderer : Options de rendu (transparence pour AR)
       - background : Transparent pour voir la camera
       ============================================ -->
  
  <a-scene
    webxr="requiredFeatures: local-floor, hit-test;
           optionalFeatures: anchors;
           referenceSpaceType: local-floor;"
    vr-mode-ui="enabled: false"
    renderer="colorManagement: true; alpha: true; antialias: true"
    background="color: transparent">
    
    <!-- ============================================
         ASSETS (Modeles 3D, sons, textures)
         ============================================
         
         On declare ici tous les fichiers a precharger.
         Ensuite on les utilise avec #id-de-l-asset
         ============================================ -->
    
    <a-assets>
      <!-- Modele de tasse de cafe -->
      <a-asset-item id="coffee-cup-model" src="./models/Coffee cup.glb"></a-asset-item>
      
      <!-- Modele de machine a cafe (pour plus tard) -->
      <a-asset-item id="coffee-machine-model" src="./models/Coffee Machine.glb"></a-asset-item>
    </a-assets>

    <!-- ============================================
         ECLAIRAGE
         ============================================
         
         - ambient : Lumiere uniforme partout
         - directional : Comme le soleil, avec ombres
         ============================================ -->
    
    <a-light type="ambient" intensity="0.6"></a-light>
    <a-light type="directional" 
             position="1 2 1" 
             intensity="0.8" 
             cast-shadow="true">
    </a-light>

    <!-- ============================================
         CAMERA
         ============================================
         
         En AR, la camera est controlee par le casque.
         On met juste la position de depart.
         ============================================ -->
    
    <a-camera position="0 1.6 0"></a-camera>

    <!-- ============================================
         HIT-TEST (Detection de surfaces)
         ============================================
         
         Inspire de webxr-samples/hit-test.html :
         1. Cree un xrHitTestSource depuis l'espace viewer
         2. A chaque frame, detecte ou le regard croise une surface
         3. Deplace le reticule a cette position
         ============================================ -->
    
    <a-entity xr-hit-test="reticle: #reticle"></a-entity>

    <!-- ============================================
         OBJECT PLACER (Placement d'objets)
         ============================================
         
         Ecoute l'evenement "select" de WebXR (tap ecran / trigger)
         et place l'objet a la position du reticule.
         ============================================ -->
    
    <a-entity xr-object-placer="model: #coffee-cup-model; scale: 0.1"></a-entity>

    <!-- ============================================
         RETICULE (Curseur de placement)
         ============================================
         
         Ce cercle apparait sur les surfaces detectees.
         Il est deplace par le composant surface-detector.
         ============================================ -->
    
    <a-entity id="reticle" visible="false">
      <!-- Cercle externe (vert) -->
      <a-ring color="#00FF00"
              radius-inner="0.08"
              radius-outer="0.12"
              rotation="-90 0 0"
              material="shader: flat; opacity: 0.9">
      </a-ring>
      
      <!-- Cercle interne (jaune) -->
      <a-ring color="#FFFF00"
              radius-inner="0.03"
              radius-outer="0.05"
              rotation="-90 0 0"
              material="shader: flat">
      </a-ring>
    </a-entity>

    <!-- ============================================
         MANETTES OCULUS QUEST
         ============================================
         
         - oculus-touch-controls : Detecte la manette
         - controller-grab : Permet d'attraper (GRIP)
         ============================================ -->
    
    <!-- Manette gauche -->
    <a-entity id="left-controller"
              oculus-touch-controls="hand: left"
              controller-grab="hand: left">
    </a-entity>
    
    <!-- Manette droite -->
    <a-entity id="right-controller"
              oculus-touch-controls="hand: right"
              controller-grab="hand: right">
    </a-entity>

  </a-scene>

  <!-- ============================================
       SCRIPTS
       ============================================
       
       Vite s'occupe de bundler main.js qui importe
       tous les composants A-Frame necessaires.
       ============================================ -->
  
  <script type="module" src="/src/main.js"></script>
  
</body>
</html>
